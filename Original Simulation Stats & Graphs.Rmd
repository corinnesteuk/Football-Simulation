---
title: "Original Simulation Stats"
author: "Corinne Steuk and Jocelyn Garcia"
date: "12/13/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(Rlab)
```

## Introduction 

The game of football is an interesting, yet complex game to assess through statistics. Probability and variable distributions are required to represent every aspect of the game. Football consists of two teams with eleven players on the field at a time. The objective is for the offense (the team in possession of the ball) to run a series of plays to reach the endzone for a touchdown. The offense not only has to reach the endzone, but they also have to travel at least ten yards every four plays (to reach a “first down”) during their drive. The term “drive” refers to the series of plays while the offense has the ball. A drive results in either a success (touchdown) or failure (they did not surpass ten yards in four plays). For the scope of this project, the focus narrows only on the offensives drives in two main aspects. First, the play decision probability (run or pass) by the quarterback or offensive coordinator and its affect to the outcome of both the play and the drive. More specifically, the analysis regards how the parameters of the distribution representing the decision of play effects the success of this play (the yardage gained or lost). Second, the talent of the team to carry out either the run or the pass plays and gain the greatest number of yards. This is represented by a change of the parameters in the run and pass random variable distributions. An in-depth analysis for both of these observations factors is explain in the methods and results below. 

Certain assumptions are established prior to the simulation to simplify and maintain consistency in the project. First, all drives start at the 25-yard-line as a result of a touchback. Therefore, the offense has to gain at least 75 yards to reach a touchdown. Next, the offense will get four downs (or attempts) to reach the first down. While most of the time the offense will choose to punt the ball to the other team on the last down, this assumption allows for a drive to end in a measurable failure. There is also the possibility that if the offense is on the fourth down and within a certain range of the endzone, they will choose to kick a field goal for half the points of a touchdown. Since the project focuses on touchdowns, the assumption that there are no field goals maximizes the opportunity for the team to reach a touchdown. Finally, the offense could unexpectedly lose possession of the ball during the drive. This could be caused by either a fumble (an offensive player drops the ball, and the defense takes it) or an interception (a pass is caught by the defense). The project does not account for the probability of a fumble or interception, but this (and all the assumptions mentioned) could be considered for future work on this simulation.  

## Methods

For our simulation, we first created a list called state with four elements: down, downyards, totyards, and totdowns for the current down before the next first down (1- 4 rotation), the number of yards gained or lost in the current down before the next first down, a running total of yards gained or lost in the play (all the downs), and a running total of the number of plays (total number of downs), respectively. Each of these elements is initially set to 0 except for down, as a team cannot be on down 0.  

The function titled “play” determines the number of yards the team will gain or lose in a given play. This function begins with the decision to perform a running or passing play, which is determined by a Bernoulli distribution with a probability of .567 for a running play Figure.1. If this distribution returns a 1, the decision is a running play, and a yardage is returned from a normal distribution with mean 3 and standard deviation 3 Figure.2a-b. In a running play, a team may gain or lose yardage. This is represented by a normal distribution with a mean and standard deviation set to three. After this play is chosen and the yardage is obtained, the “state” list is updated accordingly and checked to see if there is a touchdown or if the team runs out of downs. 

If the decision is a passing play - that is, the Bernoulli distribution returns a 0 - a yardage is returned from a log normal distribution with mean log (10) and standard deviation 1 Figure.3a. For a passing play, yardage will always result in a positive number between 3 and 75. Given the yardage is within this range, a probability of success is then assigned to the pass, using an exponential function. This uses .97 as the base and the random variable yardage as the exponent. This makes smaller passes very likely and longer passes less likely, as shown in Figure.3c. We created a variable called “complete_check” to determine the result of the passing play from a Bernoulli distribution with the resulting probability of the exponential function. If “complete_check” returns a 1, then the passing play is successful, and the yardage is returned from the play function. If “complete_check” returns a 0, the passing play is unsuccessful, and the returned yardage is 0.  

A function titled “drive” encompasses a simulation of a series of plays until a success (touchdown) or failure (ran out of downs before a first down). Drive keeps track of the “state” elements and changes them as the drive continues. Drive will run until there is a success or failure, continuing as long as the downs count is less than or equal to 4 and the total yards are less than 75. The results of the play function are assigned to a variable named “yards,” which are added to the state elements “downyards” and “totyards” as the drive continues. Drive stops under 2 conditions only: 1) a touchdown, as in total yards reach or pass 75, or 2) a failure, as in 10 yards are not reached in the rotation of four plays. The project is the replication of the “drive” function many times for data analysis of the final results.  

We decided to change various aspects of our project to see how the outcomes are affected. First, we simulated only running plays to see how the probability of a touchdown changes, and then did the same for passing plays. While unrealistic of a game of football, we were simply interested in the significance of one play over the other in the project. Next, we changed the probability of the Bernoulli distribution to different numbers to see how that influenced the probability of a touchdown.  

## Results
To begin, we sampled from a Bernoulli Distribution with probability of that a decision is a run play (==1) is .567.The decision to choose a run play follows a Bernoulli distribution with the probability of choosing a run set to .567. Figure.1 below confirms that a run play will be chosen slightly more times than a pass play.

```{r, echo = FALSE}

hist(replicate(1000, rbern(1, .567)), main = ' Figure.1 : Histogram of Decision Bermoulli', xlab = 'Decision (1 == Run Play)')

```

The run play yardage is sampled from a normal distribution with mean 3 and standard deviation 3 (numbers are rounded to the nearest whole number)
Figure.2a shows the spread of the random sample data points. Figure.2b shows the pdf of the normal distribution given the chosen parameters.
```{r, echo = FALSE}
#Figure.2a
x <- seq(1, 1000, 1)
y <- replicate(1000, round(rnorm(1, mean = 3, sd = 3)))
plot(x, y, main = 'Figure.2a Spread of Possible Run Yardages', ylab = 'Yardage', xlab = 'Play Number')
abline(h = 3, col = 'red')

#Figure.2b
i <- seq(-10, 10, .01)
#plot(dnorm(i, mean = 3, sd = 3), main = "Run Play Normal PDF", ylab = 'Density')
plot(i,dnorm(i, mean = 3, sd = 3), type = "l", main = "Figure.2b Run Play Normal PDF", lwd = 2, xlab = "", ylab = 'Density')
abline(v = 3, col = 'red')
```

The pass play yardage is sampled from a log normal distribution with mean log(10) and standard deviation 1 (numbers are rounded to the nearest whole number). The spread and pdf are shown in Figures 3a and 3b, respectively. The yardage is then the exponent variable in an exponential distribution of find probability of success represented in Figure.3c. This probability is used as the parameter in a Bernoulli PDF to find whether the pass was completed or not. 
```{r, echo = FALSE}
#Figure.3a
x <- seq(1, 1000, 1)
y <- replicate(length(x), rlnorm(1, mean = log(10), sd = 1))
plot(x, y, main = 'Figure.3a : Spread of Possible Pass Yardages', ylab = 'Yardage', xlab = 'Play Number', ylim = c(0, 75))
abline(h = 75, col = 'blue')
abline(h = 3, col = 'blue')

#Figure.3b
i <- seq(0, 75, .1)
plot(i,dlnorm(i, mean = log(10), sd = 1), type = "l", main = "Figure.3b : Pass Play Log - Normal PDF", lwd = 2, xlab = "", ylab = 'Density', xlim = c(0, 70))
abline(v = log(10), col = 'red')

#Figure.3c
x_comp <- seq(3, 75, 1)
y_comp <- .97^(x_comp)
plot(x_comp, y_comp, type = 'l', main = "Figure.3c : Probability of Completing a Pass Given its Length", xlab = "Yardage", ylab = "Completion Probability")

```

Using the original distributions and parameters, the probability to score a touchdown on a given drive is about .56. If a drive results in a touchdown, the average total number of plays it took is about 5.37. In all tests, the number of simulations is set equal to 10,000.  
```{r, echo = FALSE}
state <- list()
state$down <- 1 
state$downyards <- 0 
state$totyards <- 0 
state$totdowns <- 0 
play <- function(){
  decision <- rbern(1, .567)
 if (decision ==1L){
   yardage <- round(rnorm(1, mean = 3, sd = 3))
   return(yardage)
 }else{
   yardage <- 0
   while ((yardage < 3) | (yardage > 75)){
     yardage <- rlnorm(1, mean = log(10), sd = 1)
     yardage <- round(yardage)
   }
   #Given his pass is of length 'yardage,' 
   #what is the probability that he can complete a pass of this length?
   p_comp <- .97^(yardage)
   complete_check <- rbern(1, prob = p_comp)
   if(complete_check ==1){
     return(yardage)
   }else{
     yardage <- 0 
     return (yardage)
   }
 }
}

drive <-function(){
state$down <- 1 
state$downyards <- 0 
state$totyards <- 0 
state$totdowns <- 0 
#while total yards is less than 75 and down is less than 5
while ((state$totyards < 75) & (state$down <= 4)){
yards <- play()

state$down <- state$down +1 
state$downyards <-  state$downyards + yards
state$totyards <- state$totyards + yards
state$totdowns <-  state$totdowns + 1

if (state$totyards >= 75 ){
  break
}else if(state$downyards >= 10){
  state$down <- 1
  state$downyards <- 0
}else if(state$down > 4){
  break
}

}
return(state)}
nsim <- 10000
t_yrds <- c(replicate(nsim, 0))
t_plays <- c(replicate(nsim, 0))
for (i in 1:nsim){
  j <- drive()
  t_yrds[i] <- j$totyards
  t_plays[i] <- j$totdowns
}
td <- 0
plays_cnt <- 0
td_idx <- which(t_yrds >= 75)
for (i in t_yrds){
  if (i >= 75){
    td = td +1
  }
}
for (t in td_idx){
   plays_cnt <- plays_cnt + t_plays[t]
}
prob_td <- td/length(t_yrds)
prob_td

#Average Number of Plays to Get a Touchdown
plays_cnt/length(t_plays)

```

The first changes made were to simulate drives of only one type of play. First, we simulated the event that a drive only includes pass plays. The results did not change significantly from the original simulation. 
```{r, echo = FALSE}
play <- function(){
   yardage <- 0
   while ((yardage < 3) | (yardage > 75)){
     yardage <- rlnorm(1, mean = log(10), sd = 1)
     yardage <- round(yardage)
   #Given his pass is of length 'yardage,' 
   #what is the probability that he can complete a pass of this length?
   p_comp <- .97^(yardage)
   complete_check <- rbern(1, prob = p_comp)
   if(complete_check ==1){
     return(yardage)
   }else{
     yardage <- 0 
     return (yardage)
   }
 }
}

drive <-function(){
state$down <- 1 
state$downyards <- 0 
state$totyards <- 0 
state$totdowns <- 0 
#while total yards is less than 75 and down is less than 5
while ((state$totyards < 75) & (state$down <= 4)){
yards <- play()

state$down <- state$down +1 
state$downyards <-  state$downyards + yards
state$totyards <- state$totyards + yards
state$totdowns <-  state$totdowns + 1

if (state$totyards >= 75 ){
  break
}else if(state$downyards >= 10){
  state$down <- 1
  state$downyards <- 0
}else if(state$down > 4){
  break
}

}
return(state)}

nsim <- 10000
t_yrds <- c(replicate(nsim, 0))
t_plays <- c(replicate(nsim, 0))
for (i in 1:nsim){
  j <- drive()
  t_yrds[i] <- j$totyards
  t_plays[i] <- j$totdowns
}
td <- 0
plays_cnt <- 0
td_idx <- which(t_yrds >= 75)
for (i in t_yrds){
  if (i >= 75){
    td = td +1
  }
}
for (t in td_idx){
   plays_cnt <- plays_cnt + t_plays[t]
}
prob_td <- td/length(t_yrds)
prob_td

#Average Number of Plays to Get a Touchdown
plays_cnt/length(t_plays)

```

The next change was to simulate drives with only run plays. The probability significantly decreased making it very unlikely for a team to score a touchdoewn from only run plays. 
```{r, echo = FALSE}
play_run <- function(){
   yardage <- round(rnorm(1, mean = 3, sd = 3))
 }
drive <-function(){
state$down <- 1 
state$downyards <- 0 
state$totyards <- 0 
state$totdowns <- 0 
#while total yards is less than 75 and down is less than 5
while ((state$totyards < 75) & (state$down <= 4)){
yards <- play_run()
state$down <- state$down +1 
state$downyards <-  state$downyards + yards
state$totyards <- state$totyards + yards
state$totdowns <-  state$totdowns + 1
if (state$totyards >= 75 ){
  break
}else if(state$downyards >= 10){
  state$down <- 1
  state$downyards <- 0
}else if(state$down > 4){
  break
}
}
return(state)}
nsim <- 10000
t_yrds <- c(replicate(nsim, 0))
t_plays <- c(replicate(nsim, 0))
for (i in 1:nsim){
  j <- drive()
  t_yrds[i] <- j$totyards
  t_plays[i] <- j$totdowns
}
td <- 0
plays_cnt <- 0
td_idx <- which(t_yrds >= 75)
for (i in t_yrds){
  if (i >= 75){
    td = td +1
  }
}
for (t in td_idx){
   plays_cnt <- plays_cnt + t_plays[t]
}
prob_td <- td/length(t_yrds)
prob_td

#Average Number of Plays to Get a Touchdown
plays_cnt/length(t_plays)

```

The final change will revert back to using a Bernoulli distribution to select each play in the drive; however, we will weigh this distribution more unevenly than the original. Before, we used a .567 probability of choosing a run play (this number is based of background research on the average)
































## Appendix
**Variable Instantiation**
```{r}
state <- list()
state$down <- 1 
state$downyards <- 0 
state$totyards <- 0 
state$totdowns <- 0 
```
**Play Function**
```{r}
play <- function(){
  decision <- rbern(1, .567)
 if (decision ==1L){
   yardage <- round(rnorm(1, mean = 3, sd = 3))
   return(yardage)
 }else{
   yardage <- 0
   while ((yardage < 3) | (yardage > 75)){
     yardage <- rlnorm(1, mean = log(10), sd = 1)
     yardage <- round(yardage)
   }
   #Given his pass is of length 'yardage,' 
   #what is the probability that he can complete a pass of this length?
   p_comp <- .97^(yardage)
   complete_check <- rbern(1, prob = p_comp)
   if(complete_check ==1){
     return(yardage)
   }else{
     yardage <- 0 
     return (yardage)
   }
 }
}

drive <-function(){
state$down <- 1 
state$downyards <- 0 
state$totyards <- 0 
state$totdowns <- 0 
#while total yards is less than 75 and down is less than 5
while ((state$totyards < 75) & (state$down <= 4)){
yards <- play()

state$down <- state$down +1 
state$downyards <-  state$downyards + yards
state$totyards <- state$totyards + yards
state$totdowns <-  state$totdowns + 1

if (state$totyards >= 75 ){
  break
}else if(state$downyards >= 10){
  state$down <- 1
  state$downyards <- 0
}else if(state$down > 4){
  break
}

}
return(state)}
```

**Figure.1 : Decision Distribution**
```{r, eval = FALSE}

hist(replicate(1000, rbern(1, .567)), main = 'Figure.1 Histogram of Decision Bermoulli', xlab = 'Decision (1 == Run Play)')

```
**Figure.2a-b : Run Play Distribution**
```{r, eval = FALSE}
#Figure.2a
x <- seq(1, 1000, 1)
y <- replicate(1000, round(rnorm(1, mean = 3, sd = 3)))
plot(x, y, main = 'Figure.2a Spread of Possible Run Yardages', ylab = 'Yardage', xlab = 'Play Number')
abline(h = 3, col = 'red')

#Figure.2b
i <- seq(-10, 10, .01)
#plot(dnorm(i, mean = 3, sd = 3), main = "Run Play Normal PDF", ylab = 'Density')
plot(i,dnorm(i, mean = 3, sd = 3), type = "l", main = "Figure.2b Run Play Normal PDF", lwd = 2, xlab = "", ylab = 'Density')
abline(v = 3, col = 'red')
```
**Figure.3a-c : Pass Play Distribution**
```{r, eval = FALSE}
#Figure.3a
x <- seq(1, 1000, 1)
y <- replicate(length(x), rlnorm(1, mean = log(10), sd = 1))
plot(x, y, main = 'Figure.3a : Spread of Possible Pass Yardages', ylab = 'Yardage', xlab = 'Play Number', ylim = c(0, 75))
abline(h = 75, col = 'blue')
abline(h = 3, col = 'blue')

#Figure.3b
i <- seq(0, 75, .1)
plot(i,dlnorm(i, mean = log(10), sd = 1), type = "l", main = "Figure.3b : Pass Play Log - Normal PDF", lwd = 2, xlab = "", ylab = 'Density', xlim = c(0, 70))
abline(v = log(10), col = 'red')

#Figure.3c
x_comp <- seq(3, 75, 1)
y_comp <- .97^(x_comp)
plot(x_comp, y_comp, type = 'l', main = "Figure.3c : Probability of Completing a Pass Given its Length", xlab = "Yardage", ylab = "Completion Probability")

```
**Original Simulation**
```{r, eval = FALSE}
nsim <- 10000
t_yrds <- c(replicate(nsim, 0))
t_plays <- c(replicate(nsim, 0))
for (i in 1:nsim){
  j <- drive()
  t_yrds[i] <- j$totyards
  t_plays[i] <- j$totdowns
}
td <- 0
plays_cnt <- 0
td_idx <- which(t_yrds >= 75)
for (i in t_yrds){
  if (i >= 75){
    td = td +1
  }
}
for (t in td_idx){
   plays_cnt <- plays_cnt + t_plays[t]
}
prob_td <- td/length(t_yrds)
prob_td

#Average Number of Plays to Get a Touchdown
plays_cnt/length(t_plays)

```

**Pass-Only Simulation**
```{r, eval = FALSE}
play_pass <- function(){
   yardage <- 0
   while ((yardage < 3) | (yardage > 75)){
     yardage <- rlnorm(1, mean = log(10), sd = 1)
     yardage <- round(yardage)
   #Given his pass is of length 'yardage,' 
   #what is the probability that he can complete a pass of this length?
   p_comp <- .97^(yardage)
   complete_check <- rbern(1, prob = p_comp)
   if(complete_check ==1){
     return(yardage)
   }else{
     yardage <- 0 
     return (yardage)
   }
 }
}

drive <-function(){
state$down <- 1 
state$downyards <- 0 
state$totyards <- 0 
state$totdowns <- 0 
#while total yards is less than 75 and down is less than 5
while ((state$totyards < 75) & (state$down <= 4)){
yards <- play_pass()

state$down <- state$down +1 
state$downyards <-  state$downyards + yards
state$totyards <- state$totyards + yards
state$totdowns <-  state$totdowns + 1

if (state$totyards >= 75 ){
  break
}else if(state$downyards >= 10){
  state$down <- 1
  state$downyards <- 0
}else if(state$down > 4){
  break
}

}
return(state)}
nsim <- 10000
t_yrds <- c(replicate(nsim, 0))
t_plays <- c(replicate(nsim, 0))
for (i in 1:nsim){
  j <- drive()
  t_yrds[i] <- j$totyards
  t_plays[i] <- j$totdowns
}
td <- 0
plays_cnt <- 0
td_idx <- which(t_yrds >= 75)
for (i in t_yrds){
  if (i >= 75){
    td = td +1
  }
}
for (t in td_idx){
   plays_cnt <- plays_cnt + t_plays[t]
}
prob_td <- td/length(t_yrds)
prob_td

#Average Number of Plays to Get a Touchdown
plays_cnt/length(t_plays)

```

**Run-Only Simulation**
```{r, eval = FALSE}
play_run <- function(){
   yardage <- round(rnorm(1, mean = 3, sd = 3))
 }
drive <-function(){
state$down <- 1 
state$downyards <- 0 
state$totyards <- 0 
state$totdowns <- 0 
#while total yards is less than 75 and down is less than 5
while ((state$totyards < 75) & (state$down <= 4)){
yards <- play_run()
state$down <- state$down +1 
state$downyards <-  state$downyards + yards
state$totyards <- state$totyards + yards
state$totdowns <-  state$totdowns + 1
if (state$totyards >= 75 ){
  break
}else if(state$downyards >= 10){
  state$down <- 1
  state$downyards <- 0
}else if(state$down > 4){
  break
}
}
return(state)}
nsim <- 10000
t_yrds <- c(replicate(nsim, 0))
t_plays <- c(replicate(nsim, 0))
for (i in 1:nsim){
  j <- drive()
  t_yrds[i] <- j$totyards
  t_plays[i] <- j$totdowns
}
td <- 0
plays_cnt <- 0
td_idx <- which(t_yrds >= 75)
for (i in t_yrds){
  if (i >= 75){
    td = td +1
  }
}
for (t in td_idx){
   plays_cnt <- plays_cnt + t_plays[t]
}
prob_td <- td/length(t_yrds)
prob_td

#Average Number of Plays to Get a Touchdown
plays_cnt/length(t_plays)

```



