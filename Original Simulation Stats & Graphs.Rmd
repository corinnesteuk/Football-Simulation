---
title: "Original Simulation Stats"
author: "Corinne Steuk"
date: "11/20/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(Rlab)
```

## Results
To begin, we sampled from a Bernoulli Distribution with probability of that a decision is a run play (==1) is .567.The decision to choose a run play follows a Bernoulli distribution with the probability of choosing a run set to .567. Figure.1 below confirms that a run play will be chosen slightly more times than a pass play.

```{r, echo = FALSE}

hist(replicate(1000, rbern(1, .567)), main = ' Figure.1 : Histogram of Decision Bermoulli', xlab = 'Decision (1 == Run Play)')

```

The run play yardage is sampled from a normal distribution with mean 3 and standard deviation 3 (numbers are rounded to the nearest whole number)
Figure.2a shows the spread of the random sample data points. Figure.3b shows the pdf of the normal distribution given the chosen parameters.
```{r, echo = FALSE}
#Figure.2a
x <- seq(1, 1000, 1)
y <- replicate(1000, round(rnorm(1, mean = 3, sd = 3)))
plot(x, y, main = 'Figure.2a Spread of Possible Run Yardages', ylab = 'Yardage', xlab = 'Play Number')
abline(h = 3, col = 'red')

#Figure.2b
i <- seq(-10, 10, .01)
#plot(dnorm(i, mean = 3, sd = 3), main = "Run Play Normal PDF", ylab = 'Density')
plot(i,dnorm(i, mean = 3, sd = 3), type = "l", main = "Figure.2b Run Play Normal PDF", lwd = 2, xlab = "", ylab = 'Density')
abline(v = 3, col = 'red')
```

The pass play yardage is sampled from a log normal distribution with mean log(10) and standard deviation 1 (numbers are rounded to the nearest whole number). The spread and pdf are shown in Figures 3a and 3b, respectively. The yardage is then the exponent variable in an exponential distribution of find probability of success represented in Figure.3c. This probability is used as the parameter in a Bernoulli PDF to find whether the pass was completed or not. 
```{r, echo = FALSE}
#Figure.3a
x <- seq(1, 1000, 1)
y <- replicate(length(x), rlnorm(1, mean = log(10), sd = 1))
plot(x, y, main = 'Figure.3a : Spread of Possible Pass Yardages', ylab = 'Yardage', xlab = 'Play Number', ylim = c(0, 75))
abline(h = 75, col = 'blue')
abline(h = 3, col = 'blue')

#Figure.3b
i <- seq(0, 75, .1)
plot(i,dlnorm(i, mean = log(10), sd = 1), type = "l", main = "Figure.3b : Pass Play Log - Normal PDF", lwd = 2, xlab = "", ylab = 'Density', xlim = c(0, 70))
abline(v = log(10), col = 'red')

#Figure.3c
x_comp <- seq(3, 75, 1)
y_comp <- .97^(x_comp)
plot(x_comp, y_comp, type = 'l', main = "Figure.3c : Probability of Completing a Pass Given its Length", xlab = "Yardage", ylab = "Completion Probability")

```

Using the original distributions and parameters, the probability to score a touchdown on a given drive is about .35. If a drive results in a touchdown, the average total number of plays it took is about 4.37. In all tests, the number of simulations is set equal to 10,000. 
```{r, echo = FALSE}
state <- list()
state$down <- 1 
state$downyards <- 0 
state$totyards <- 0 
state$totdowns <- 0 
play <- function(){
  decision <- rbern(1, .567)
 if (decision ==1L){
   yardage <- round(rnorm(1, mean = 3, sd = 3))
   return(yardage)
 }else{
   yardage <- 0
   while ((yardage < 3) | (yardage > 75)){
     yardage <- rlnorm(1, mean = log(10), sd = 1)
     yardage <- round(yardage)
   }
   #Given his pass is of length 'yardage,' 
   #what is the probability that he can complete a pass of this length?
   p_comp <- .97^(yardage)
   complete_check <- rbern(1, prob = p_comp)
   if(complete_check ==1){
     return(yardage)
   }else{
     yardage <- 0 
     return (yardage)
   }
 }
}

drive <-function(){
state$down <- 1 
state$downyards <- 0 
state$totyards <- 0 
state$totdowns <- 0 
#while total yards is less than 75 and down is less than 5
while ((state$totyards < 75) & (state$down <= 4)){
yards <- play()

state$down <- state$down +1 
state$downyards <-  state$downyards + yards
state$totyards <- state$totyards + yards
state$totdowns <-  state$totdowns + 1

if (state$totyards >= 75 ){
  break
}else if(state$downyards >= 10){
  state$down <- 1
  state$downyards <- 0
}else if(state$down > 4){
  break
}

}
return(state)}
nsim <- 10000
t_yrds <- c(replicate(nsim, 0))
t_plays <- c(replicate(nsim, 0))
for (i in 1:nsim){
  j <- drive()
  t_yrds[i] <- j$totyards
  t_plays[i] <- j$totdowns
}
td <- 0
plays_cnt <- 0
td_idx <- which(t_yrds >= 75)
for (i in t_yrds){
  if (i >= 75){
    td = td +1
  }
}
for (t in td_idx){
   plays_cnt <- plays_cnt + t_plays[t]
}
prob_td <- td/length(t_yrds)
prob_td

#Average Number of Plays to Get a Touchdown
plays_cnt/length(t_plays)

```

The first changes made were to simulate drives of only one type of play. First, we simulated the event that a drive only includes pass plays. The results did not change significantly from the original simulation. 
```{r, echo = FALSE}
play <- function(){
   yardage <- 0
   while ((yardage < 3) | (yardage > 75)){
     yardage <- rlnorm(1, mean = log(10), sd = 1)
     yardage <- round(yardage)
   #Given his pass is of length 'yardage,' 
   #what is the probability that he can complete a pass of this length?
   p_comp <- .97^(yardage)
   complete_check <- rbern(1, prob = p_comp)
   if(complete_check ==1){
     return(yardage)
   }else{
     yardage <- 0 
     return (yardage)
   }
 }
}

drive <-function(){
state$down <- 1 
state$downyards <- 0 
state$totyards <- 0 
state$totdowns <- 0 
#while total yards is less than 75 and down is less than 5
while ((state$totyards < 75) & (state$down <= 4)){
yards <- play()

state$down <- state$down +1 
state$downyards <-  state$downyards + yards
state$totyards <- state$totyards + yards
state$totdowns <-  state$totdowns + 1

if (state$totyards >= 75 ){
  break
}else if(state$downyards >= 10){
  state$down <- 1
  state$downyards <- 0
}else if(state$down > 4){
  break
}

}
return(state)}

nsim <- 10000
t_yrds <- c(replicate(nsim, 0))
t_plays <- c(replicate(nsim, 0))
for (i in 1:nsim){
  j <- drive()
  t_yrds[i] <- j$totyards
  t_plays[i] <- j$totdowns
}
td <- 0
plays_cnt <- 0
td_idx <- which(t_yrds >= 75)
for (i in t_yrds){
  if (i >= 75){
    td = td +1
  }
}
for (t in td_idx){
   plays_cnt <- plays_cnt + t_plays[t]
}
prob_td <- td/length(t_yrds)
prob_td

#Average Number of Plays to Get a Touchdown
plays_cnt/length(t_plays)

```

The next change was to simulate drives with only run plays. The probability significantly decreased making it very unlikely for a team to score a touchdoewn from only run plays. 
```{r, echo = FALSE}
play_run <- function(){
   yardage <- round(rnorm(1, mean = 3, sd = 3))
 }
drive <-function(){
state$down <- 1 
state$downyards <- 0 
state$totyards <- 0 
state$totdowns <- 0 
#while total yards is less than 75 and down is less than 5
while ((state$totyards < 75) & (state$down <= 4)){
yards <- play_run()
state$down <- state$down +1 
state$downyards <-  state$downyards + yards
state$totyards <- state$totyards + yards
state$totdowns <-  state$totdowns + 1
if (state$totyards >= 75 ){
  break
}else if(state$downyards >= 10){
  state$down <- 1
  state$downyards <- 0
}else if(state$down > 4){
  break
}
}
return(state)}
nsim <- 10000
t_yrds <- c(replicate(nsim, 0))
t_plays <- c(replicate(nsim, 0))
for (i in 1:nsim){
  j <- drive()
  t_yrds[i] <- j$totyards
  t_plays[i] <- j$totdowns
}
td <- 0
plays_cnt <- 0
td_idx <- which(t_yrds >= 75)
for (i in t_yrds){
  if (i >= 75){
    td = td +1
  }
}
for (t in td_idx){
   plays_cnt <- plays_cnt + t_plays[t]
}
prob_td <- td/length(t_yrds)
prob_td

#Average Number of Plays to Get a Touchdown
plays_cnt/length(t_plays)

```

The final change will revert back to using a Bernoulli distribution to select each play in the drive; however, we will weigh this distribution more unevenly than the original. Before, we used a .567 probability of choosing a run play (this number is based of background research on the average)




```{r}
x<-seq(0, 100, 1)
p_comp_orig <- .97^(x)
plot(x, p_comp_orig, type = 'l', main = 'Original Sim: Base = .97')

x<-seq(0, 100, 1)
p_comp1 <- .9^(x)
plot(x, p_comp1, type = 'l', main = 'Base = .9')

x<-seq(0, 100, 1)
p_comp2 <- .8^(x)
plot(x, p_comp2, type = 'l', main = 'Base = .8')


```































## Appendix
**Variable Instantiation**
```{r}
state <- list()
state$down <- 1 
state$downyards <- 0 
state$totyards <- 0 
state$totdowns <- 0 
```
**Play Function**
```{r}
play <- function(){
  decision <- rbern(1, .567)
 if (decision ==1L){
   yardage <- round(rnorm(1, mean = 3, sd = 3))
   return(yardage)
 }else{
   yardage <- 0
   while ((yardage < 3) | (yardage > 75)){
     yardage <- rlnorm(1, mean = log(10), sd = 1)
     yardage <- round(yardage)
   }
   #Given his pass is of length 'yardage,' 
   #what is the probability that he can complete a pass of this length?
   p_comp <- .97^(yardage)
   complete_check <- rbern(1, prob = p_comp)
   if(complete_check ==1){
     return(yardage)
   }else{
     yardage <- 0 
     return (yardage)
   }
 }
}

drive <-function(){
state$down <- 1 
state$downyards <- 0 
state$totyards <- 0 
state$totdowns <- 0 
#while total yards is less than 75 and down is less than 5
while ((state$totyards < 75) & (state$down <= 4)){
yards <- play()

state$down <- state$down +1 
state$downyards <-  state$downyards + yards
state$totyards <- state$totyards + yards
state$totdowns <-  state$totdowns + 1

if (state$totyards >= 75 ){
  break
}else if(state$downyards >= 10){
  state$down <- 1
  state$downyards <- 0
}else if(state$down > 4){
  break
}

}
return(state)}
```

**Figure.1 : Decision Distribution**
```{r, eval = FALSE}

hist(replicate(1000, rbern(1, .567)), main = 'Figure.1 Histogram of Decision Bermoulli', xlab = 'Decision (1 == Run Play)')

```
**Figure.2a-b : Run Play Distribution**
```{r, eval = FALSE}
#Figure.2a
x <- seq(1, 1000, 1)
y <- replicate(1000, round(rnorm(1, mean = 3, sd = 3)))
plot(x, y, main = 'Figure.2a Spread of Possible Run Yardages', ylab = 'Yardage', xlab = 'Play Number')
abline(h = 3, col = 'red')

#Figure.2b
i <- seq(-10, 10, .01)
#plot(dnorm(i, mean = 3, sd = 3), main = "Run Play Normal PDF", ylab = 'Density')
plot(i,dnorm(i, mean = 3, sd = 3), type = "l", main = "Figure.2b Run Play Normal PDF", lwd = 2, xlab = "", ylab = 'Density')
abline(v = 3, col = 'red')
```
**Figure.3a-c : Pass Play Distribution**
```{r, eval = FALSE}
#Figure.3a
x <- seq(1, 1000, 1)
y <- replicate(length(x), rlnorm(1, mean = log(10), sd = 1))
plot(x, y, main = 'Figure.3a : Spread of Possible Pass Yardages', ylab = 'Yardage', xlab = 'Play Number', ylim = c(0, 75))
abline(h = 75, col = 'blue')
abline(h = 3, col = 'blue')

#Figure.3b
i <- seq(0, 75, .1)
plot(i,dlnorm(i, mean = log(10), sd = 1), type = "l", main = "Figure.3b : Pass Play Log - Normal PDF", lwd = 2, xlab = "", ylab = 'Density', xlim = c(0, 70))
abline(v = log(10), col = 'red')

#Figure.3c
x_comp <- seq(3, 75, 1)
y_comp <- .97^(x_comp)
plot(x_comp, y_comp, type = 'l', main = "Figure.3c : Probability of Completing a Pass Given its Length", xlab = "Yardage", ylab = "Completion Probability")

```
**Original Simulation**
```{r, eval = FALSE}
nsim <- 10000
t_yrds <- c(replicate(nsim, 0))
t_plays <- c(replicate(nsim, 0))
for (i in 1:nsim){
  j <- drive()
  t_yrds[i] <- j$totyards
  t_plays[i] <- j$totdowns
}
td <- 0
plays_cnt <- 0
td_idx <- which(t_yrds >= 75)
for (i in t_yrds){
  if (i >= 75){
    td = td +1
  }
}
for (t in td_idx){
   plays_cnt <- plays_cnt + t_plays[t]
}
prob_td <- td/length(t_yrds)
prob_td

#Average Number of Plays to Get a Touchdown
plays_cnt/length(t_plays)

```

**Pass-Only Simulation**
```{r, eval = FALSE}
play_pass <- function(){
   yardage <- 0
   while ((yardage < 3) | (yardage > 75)){
     yardage <- rlnorm(1, mean = log(10), sd = 1)
     yardage <- round(yardage)
   #Given his pass is of length 'yardage,' 
   #what is the probability that he can complete a pass of this length?
   p_comp <- .97^(yardage)
   complete_check <- rbern(1, prob = p_comp)
   if(complete_check ==1){
     return(yardage)
   }else{
     yardage <- 0 
     return (yardage)
   }
 }
}

drive <-function(){
state$down <- 1 
state$downyards <- 0 
state$totyards <- 0 
state$totdowns <- 0 
#while total yards is less than 75 and down is less than 5
while ((state$totyards < 75) & (state$down <= 4)){
yards <- play_pass()

state$down <- state$down +1 
state$downyards <-  state$downyards + yards
state$totyards <- state$totyards + yards
state$totdowns <-  state$totdowns + 1

if (state$totyards >= 75 ){
  break
}else if(state$downyards >= 10){
  state$down <- 1
  state$downyards <- 0
}else if(state$down > 4){
  break
}

}
return(state)}
nsim <- 10000
t_yrds <- c(replicate(nsim, 0))
t_plays <- c(replicate(nsim, 0))
for (i in 1:nsim){
  j <- drive()
  t_yrds[i] <- j$totyards
  t_plays[i] <- j$totdowns
}
td <- 0
plays_cnt <- 0
td_idx <- which(t_yrds >= 75)
for (i in t_yrds){
  if (i >= 75){
    td = td +1
  }
}
for (t in td_idx){
   plays_cnt <- plays_cnt + t_plays[t]
}
prob_td <- td/length(t_yrds)
prob_td

#Average Number of Plays to Get a Touchdown
plays_cnt/length(t_plays)

```

**Run-Only Simulation**
```{r, eval = FALSE}
play_run <- function(){
   yardage <- round(rnorm(1, mean = 3, sd = 3))
 }
drive <-function(){
state$down <- 1 
state$downyards <- 0 
state$totyards <- 0 
state$totdowns <- 0 
#while total yards is less than 75 and down is less than 5
while ((state$totyards < 75) & (state$down <= 4)){
yards <- play_run()
state$down <- state$down +1 
state$downyards <-  state$downyards + yards
state$totyards <- state$totyards + yards
state$totdowns <-  state$totdowns + 1
if (state$totyards >= 75 ){
  break
}else if(state$downyards >= 10){
  state$down <- 1
  state$downyards <- 0
}else if(state$down > 4){
  break
}
}
return(state)}
nsim <- 10000
t_yrds <- c(replicate(nsim, 0))
t_plays <- c(replicate(nsim, 0))
for (i in 1:nsim){
  j <- drive()
  t_yrds[i] <- j$totyards
  t_plays[i] <- j$totdowns
}
td <- 0
plays_cnt <- 0
td_idx <- which(t_yrds >= 75)
for (i in t_yrds){
  if (i >= 75){
    td = td +1
  }
}
for (t in td_idx){
   plays_cnt <- plays_cnt + t_plays[t]
}
prob_td <- td/length(t_yrds)
prob_td

#Average Number of Plays to Get a Touchdown
plays_cnt/length(t_plays)

```



